"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}();if(!document.getElementById("css-percentage-circle")){var link=document.createElement("link");link.id="css-percentage-circle",link.rel="stylesheet",link.href="https://cdn.rawgit.com/afuersch/css-percentage-circle/c9f4ea10/css/circle.css",document.head.appendChild(link)}var UploadArea=function(){function e(t,s){var n=this;if(_classCallCheck(this,e),this.instanceNumber=++e.instances,this.divId=t,this.options={required:!1,allowDrop:!0,allowMultiple:!0,sendTo:"https://posttestserver.com/post.php",progressArea:"UploadAreaProgress",progressColor:"green",onFilesReceived:function(e){}},this.previousProgressPercentage=0,s)for(var o=Object.keys(s),r=0;r<o.length;r++)this.options[o[r]]=s[o[r]];var i=document.getElementById(this.divId);if(i){i.addEventListener("dragover",function(e){n.ondragover(e)}),i.addEventListener("drop",function(e){n.ondrop(e)}),i.addEventListener("click",function(e){var t=document.getElementById("uploadAreaFileInput"+n.instanceNumber);t.click()}),i.style.cursor="pointer";var a=document.createElement("input");a.type="file",a.style.display="none",a.id="uploadAreaFileInput"+this.instanceNumber,this.options.required&&a.setAttribute("required",""),this.options.allowMultiple&&a.setAttribute("multiple",""),a.addEventListener("change",function(e){n.handleFiles(a.files)}),i.appendChild(a)}var l=document.getElementById(this.options.progressArea);l&&(e.hideElement(this.options.progressArea),l.innerHTML='<div id="cssProgressArea" class="c100 p0 '+this.options.progressColor+'"><span id="cssProgressAreaSpan"></span><div class="slice"><div class="bar"></div><div class="fill"></div></div></div>')}return _createClass(e,[{key:"ondragover",value:function(e){e.preventDefault()}},{key:"handleFiles",value:function(e){this.options.onFilesReceived(e),this.options.upload?this.options.upload(e):this.upload(e)}},{key:"ondrop",value:function(e){if(this.options.allowDrop){e.preventDefault();var t=e.dataTransfer;if(t.items){var s=[];if(this.options.allowMultiple)for(var n=0;n<t.items.length;n++){var o=t.items[n];if("file"==o.kind){var r=o.getAsFile();s.push(r)}}else t.items.length>0&&s.push(t.items[0].getAsFile());this.handleFiles(s)}}}},{key:"resetProgress",value:function(){var e=document.getElementById("cssProgressArea");if(e){var t=document.getElementById("cssProgressAreaSpan");t.innerHTML="0%",e.classList.remove("p100"),e.classList.add("p0")}}},{key:"onComplete",value:function(e){this.options.complete&&this.options.complete(e)}},{key:"onError",value:function(e){this.options.complete&&this.options.complete(e)}},{key:"onProgress",value:function(t){if(e.hideElement(this.divId),e.showElement(this.options.progressArea),t.lengthComputable){var s=Math.floor(t.loaded/t.total*100),n=document.getElementById("cssProgressArea");if(n){var o=document.getElementById("cssProgressAreaSpan");o.innerHTML=s+"%",n.classList.remove("p"+this.previousProgressPercentage),n.classList.add("p"+s)}100==s&&(e.showElement(this.divId),e.hideElement(this.options.progressArea),this.previousProgressPercentage=0),this.previousProgressPercentage=s}}},{key:"upload",value:function(t,s){var n=this;if(t&&t.length>0){for(var o=new FormData,r=0;r<t.length;r++){var i=t[r];o.append(i.name,i)}if(s)for(var a=Object.keys(s),l=0;l<a.length;l++)o.append(a[l],s[a[l]]);var c=new XMLHttpRequest;c.open("POST",this.options.sendTo,!0),c.upload.onprogress=function(e){n.options.progress?n.options.progress(e):n.onProgress(e)},c.onload=function(){200==c.status?n.onComplete(c.responseText):n.onError(c.responseText)},c.send(o),this.options.progress||(this.resetProgress(),e.showElement(this.options.progressArea),e.hideElement(this.divId))}}}],[{key:"hideElement",value:function(e){var t=document.getElementById(e);t&&(t.style.display="none")}},{key:"showElement",value:function(e){var t=document.getElementById(e);t&&(t.style.display="block")}}]),e}();UploadArea.instances=0;