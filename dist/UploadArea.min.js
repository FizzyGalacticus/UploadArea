"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(s,t,n){return t&&e(s.prototype,t),n&&e(s,n),s}}();if(!document.getElementById("css-percentage-circle")){var link=document.createElement("link");link.id="css-percentage-circle",link.rel="stylesheet",link.href="https://cdn.rawgit.com/afuersch/css-percentage-circle/c9f4ea10/css/circle.css",document.head.appendChild(link)}var UploadArea=function(){function e(s,t){var n=this;if(_classCallCheck(this,e),this.instanceNumber=++e.instances,this.divId=s,this.options={required:!1,allowDrop:!0,allowMultiple:!0,sendTo:"https://posttestserver.com/post.php",progressArea:"UploadAreaProgress",progressColor:"green",onFilesReceived:function(e){}},this.previousProgressPercentage=0,t)for(var r=Object.keys(t),o=0;o<r.length;o++)this.options[r[o]]=t[r[o]];var i=document.getElementById(this.divId);if(i){i.addEventListener("dragover",function(e){n.ondragover(e)}),i.addEventListener("drop",function(e){n.ondrop(e)}),i.addEventListener("click",function(e){var s=document.getElementById("uploadAreaFileInput"+n.instanceNumber);s.click()}),i.style.cursor="pointer";var a=document.createElement("input");a.type="file",a.style.display="none",a.id="uploadAreaFileInput"+this.instanceNumber,this.options.required&&a.setAttribute("required",""),this.options.allowMultiple&&a.setAttribute("multiple",""),a.addEventListener("change",function(e){n.handleFiles(a.files)}),i.appendChild(a)}var l=document.getElementById(this.options.progressArea);l&&(e.hideElement(this.options.progressArea),l.innerHTML='<div id="cssProgressArea" class="c100 p0 '+this.options.progressColor+'"><span id="cssProgressAreaSpan"></span><div class="slice"><div class="bar"></div><div class="fill"></div></div></div>')}return _createClass(e,[{key:"ondragover",value:function(e){e.preventDefault()}},{key:"handleFiles",value:function(e){this.options.onFilesReceived(e),this.options.upload?this.options.upload(e):this.upload(e)}},{key:"ondrop",value:function(e){if(this.options.allowDrop){e.preventDefault();var s=e.dataTransfer;if(s.items){var t=[];if(this.options.allowMultiple)for(var n=0;n<s.items.length;n++){var r=s.items[n];if("file"==r.kind){var o=r.getAsFile();t.push(o)}}else s.items.length>0&&t.push(s.items[0].getAsFile());this.handleFiles(t)}}}},{key:"resetProgress",value:function(){var e=document.getElementById("cssProgressArea");if(e){var s=document.getElementById("cssProgressAreaSpan");s.innerHTML="0%",e.classList.remove("p100"),e.classList.add("p0")}}},{key:"onComplete",value:function(e){this.options.complete&&this.options.complete(e)}},{key:"onError",value:function(e){this.options.error&&this.options.error(e)}},{key:"onProgress",value:function(s){if(e.hideElement(this.divId),e.showElement(this.options.progressArea),s.lengthComputable){var t=Math.floor(s.loaded/s.total*100),n=document.getElementById("cssProgressArea");if(n){var r=document.getElementById("cssProgressAreaSpan");r.innerHTML=t+"%",n.classList.remove("p"+this.previousProgressPercentage),n.classList.add("p"+t)}100==t&&(e.showElement(this.divId),e.hideElement(this.options.progressArea),this.previousProgressPercentage=0),this.previousProgressPercentage=t}}},{key:"upload",value:function(s,t){var n=this;if(s&&s.length>0){for(var r=new FormData,o=0;o<s.length;o++){var i=s[o];r.append(i.name,i)}if(t)for(var a=Object.keys(t),l=0;l<a.length;l++)r.append(a[l],t[a[l]]);var c=new XMLHttpRequest;c.open("POST",this.options.sendTo,!0),c.upload.onprogress=function(e){n.options.progress?n.options.progress(e):n.onProgress(e)},c.onload=function(){200==c.status?n.onComplete(c.responseText):n.onError(c.responseText)},c.send(r),this.options.progress||(this.resetProgress(),e.showElement(this.options.progressArea),e.hideElement(this.divId))}}}],[{key:"hideElement",value:function(e){var s=document.getElementById(e);s&&(s.style.display="none")}},{key:"showElement",value:function(e){var s=document.getElementById(e);s&&(s.style.display="block")}}]),e}();UploadArea.instances=0;